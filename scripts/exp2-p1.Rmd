---
title: "exp2-semantic-distance"
author: "Jiarong Feng"
date: "2025-06-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source(file = '../utils/exp1-utils.R')  # loads all necessary packages //NOTE: some packages
source(file = '../utils/exp2-utils.R') 
source(file = '../utils/stimuli.R')
```

```{r data-prep}
mgdf_w <- read.csv("../data/exp1/csv/clean/p3-mg-weight.csv")
usdf_w <- read.csv("../data/exp1/csv/clean/p3-us-weight.csv")
```

```{r semantic distance within each country df}
mg_pairs <- generate_color_pairs(mgdf_w)
us_pairs <- generate_color_pairs(usdf_w)
```

```{r}
distance_combined <- inner_join(
  mg_pairs %>% select(concept_1, concept_2, color_1, color_2, semantic_distance_us = semantic_distance),
  us_pairs %>% select(concept_1, concept_2, color_1, color_2, semantic_distance_mg = semantic_distance),
  by = c("concept_1", "concept_2", "color_1", "color_2")
)
```

```{r get threshold}
threshold_high_us <- quantile(distance_combined$semantic_distance_us, 0.8)
threshold_low_us  <- quantile(distance_combined$semantic_distance_us, 0.2)

threshold_high_mg <- quantile(distance_combined$semantic_distance_mg, 0.8)
threshold_low_mg  <- quantile(distance_combined$semantic_distance_mg, 0.2)
```

```{r}
ggplot(distance_combined) +
  geom_density(aes(x = semantic_distance_us, color = "US"), size = 1, adjust = 1.2) +
  geom_density(aes(x = semantic_distance_mg, color = "MG"), size = 1, adjust = 1.2) +
  labs(
    title = "Semantic Distance Distributions: US vs MG",
    x = "Semantic Distance",
    y = "Density",
    color = "Country"
  )
```

```{r}
df_long <- distance_combined %>%
  pivot_longer(
    cols = c(semantic_distance_us, semantic_distance_mg),
    names_to = "country",
    values_to = "semantic_distance"
  ) %>%
  mutate(country = recode(country,
                          semantic_distance_us = "US",
                          semantic_distance_mg = "MG"))

# Plot overlayed histogram
ggplot(df_long, aes(x = semantic_distance, fill = country)) +
  geom_histogram(position = "identity", alpha = 0.4, bins = 40, color = "black") +
  labs(
    title = "Semantic Distance Distributions: US vs MG",
    x = "Semantic Distance",
    y = "Count",
    fill = "Country"
  ) +
  theme_minimal()
```

```{r}
distance_combined <- distance_combined %>%
  mutate(
    group = case_when(
      semantic_distance_us >= threshold_high_us & semantic_distance_mg <= threshold_low_mg ~ "high_us_low_mg",
      semantic_distance_us <= threshold_low_us  & semantic_distance_mg >= threshold_high_mg ~ "low_us_high_mg",
      semantic_distance_us >= threshold_high_us & semantic_distance_mg >= threshold_high_mg ~ "high_both",
      semantic_distance_us <= threshold_low_us  & semantic_distance_mg <= threshold_low_mg  ~ "low_both",
      TRUE ~ NA_character_  # middle range â€“ ignored
    )
  )

high_us_low_mg <- distance_combined %>% filter(group == "high_us_low_mg")
low_us_high_mg <- distance_combined %>% filter(group == "low_us_high_mg")
high_both      <- distance_combined %>% filter(group == "high_both")
low_both       <- distance_combined %>% filter(group == "low_both")
```

```{r}
intersect_df <- high_us_low_mg %>%
  select(concept_1, concept_2) %>%
  distinct() %>%
  inner_join(low_us_high_mg %>% select(concept_1, concept_2) %>% distinct(), by = c("concept_1", "concept_2")) %>%
  inner_join(high_both %>% select(concept_1, concept_2) %>% distinct(), by = c("concept_1", "concept_2")) %>%
  inner_join(low_both %>% select(concept_1, concept_2) %>% distinct(), by = c("concept_1", "concept_2"))

View(intersect_df)

```

```{r}
```
