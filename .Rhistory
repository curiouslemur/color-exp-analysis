full_join(mgL_usH, mgH_usH, by=c("concept1", "concept2"))
a = full_join(mgL_usH, mgH_usH, by=c("concept1", "concept2"))
a = full_join(mgH_usL, mgL_usH, by=c("concept1", "concept2"))
View(a)
a <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2'))
View(a)
a <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
View(a)
a %>% distinct(concept1, concept2)
View(a)
# Lower and Higher thresholds for deltaS
dsL = 0.2; dsH = 0.7
dsmgL = filter(dsmg, deltaSmg <= dsL) %>% select(-deltaSmg);
dsmgH = filter(dsmg, deltaSmg >= dsH) %>% select(-deltaSmg)
dsusL = filter(dsus, deltaSus <= dsL) %>% select(-deltaSus);
dsusH = filter(dsus, deltaSus >= dsH) %>% select(-deltaSus)
mgL_usH = inner_join(dsmgL, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>% # common rows between the two dataframes
rename(mgL_usH1 = color1, mgL_usH2 = color2)
mgH_usH = inner_join(dsmgH, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usH1 = color1, mgH_usH2 = color2)
mgL_usL = inner_join(dsmgL, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgL_usL1 = color1, mgL_usL2 = color2)
mgH_usL = inner_join(dsmgH, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usL1 = color1, mgH_usL2 = color2)
a <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
a %>% distinct(concept1, concept2)
# Lower and Higher thresholds for deltaS
dsL = 0.3; dsH = 0.7
dsmgL = filter(dsmg, deltaSmg <= dsL) %>% select(-deltaSmg);
dsmgH = filter(dsmg, deltaSmg >= dsH) %>% select(-deltaSmg)
dsusL = filter(dsus, deltaSus <= dsL) %>% select(-deltaSus);
dsusH = filter(dsus, deltaSus >= dsH) %>% select(-deltaSus)
mgL_usH = inner_join(dsmgL, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>% # common rows between the two dataframes
rename(mgL_usH1 = color1, mgL_usH2 = color2)
mgH_usH = inner_join(dsmgH, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usH1 = color1, mgH_usH2 = color2)
mgL_usL = inner_join(dsmgL, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgL_usL1 = color1, mgL_usL2 = color2)
mgH_usL = inner_join(dsmgH, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usL1 = color1, mgH_usL2 = color2)
a <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
a %>% distinct(concept1, concept2)
# Lower and Higher thresholds for deltaS
dsL = 0.2; dsH = 0.7
# Lower and Higher thresholds for deltaS
dsL = 0.2; dsH = 0.7=8
dsmgL = filter(dsmg, deltaSmg <= dsL) %>% select(-deltaSmg);
dsmgH = filter(dsmg, deltaSmg >= dsH) %>% select(-deltaSmg)
dsusL = filter(dsus, deltaSus <= dsL) %>% select(-deltaSus);
dsusH = filter(dsus, deltaSus >= dsH) %>% select(-deltaSus)
mgL_usH = inner_join(dsmgL, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>% # common rows between the two dataframes
rename(mgL_usH1 = color1, mgL_usH2 = color2)
mgH_usH = inner_join(dsmgH, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usH1 = color1, mgH_usH2 = color2)
mgL_usL = inner_join(dsmgL, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgL_usL1 = color1, mgL_usL2 = color2)
mgH_usL = inner_join(dsmgH, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usL1 = color1, mgH_usL2 = color2)
a <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
a %>% distinct(concept1, concept2)
rm(a)
final <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
_final <- mgL_usH %>%
final <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
)
View(a)
final %>% distinct(concept1, concept2)
dsmg <- deltaS_mg %>% select(-deltaS_sample) %>% rename(deltaSmg = deltaS_fit)
dsus <- deltaS_us %>% select(-deltaS_sample) %>% rename(deltaSus = deltaS_fit)
# Lower and Higher thresholds for deltaS
dsL = 0.2; dsH = 0.7=8
dsmgL = filter(dsmg, deltaSmg <= dsL) %>% select(-deltaSmg);
dsmgH = filter(dsmg, deltaSmg >= dsH) %>% select(-deltaSmg)
dsusL = filter(dsus, deltaSus <= dsL) %>% select(-deltaSus);
dsusH = filter(dsus, deltaSus >= dsH) %>% select(-deltaSus)
# Lower and Higher thresholds for deltaS
dsL = 0.2; dsH = 0.7
dsmgL = filter(dsmg, deltaSmg <= dsL) %>% select(-deltaSmg);
dsmgH = filter(dsmg, deltaSmg >= dsH) %>% select(-deltaSmg)
dsusL = filter(dsus, deltaSus <= dsL) %>% select(-deltaSus);
dsusH = filter(dsus, deltaSus >= dsH) %>% select(-deltaSus)
mgL_usH = inner_join(dsmgL, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>% # common rows between the two dataframes
rename(mgL_usH1 = color1, mgL_usH2 = color2)
mgH_usH = inner_join(dsmgH, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usH1 = color1, mgH_usH2 = color2)
mgL_usL = inner_join(dsmgL, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgL_usL1 = color1, mgL_usL2 = color2)
mgH_usL = inner_join(dsmgH, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usL1 = color1, mgH_usL2 = color2)
final <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
# Lower and Higher thresholds for deltaS
dsL = 0.2; dsH = 0.8
dsmgL = filter(dsmg, deltaSmg <= dsL) %>% select(-deltaSmg);
dsmgH = filter(dsmg, deltaSmg >= dsH) %>% select(-deltaSmg)
dsusL = filter(dsus, deltaSus <= dsL) %>% select(-deltaSus);
dsusH = filter(dsus, deltaSus >= dsH) %>% select(-deltaSus)
mgL_usH = inner_join(dsmgL, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>% # common rows between the two dataframes
rename(mgL_usH1 = color1, mgL_usH2 = color2)
mgH_usH = inner_join(dsmgH, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usH1 = color1, mgH_usH2 = color2)
mgL_usL = inner_join(dsmgL, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgL_usL1 = color1, mgL_usL2 = color2)
mgH_usL = inner_join(dsmgH, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usL1 = color1, mgH_usL2 = color2)
final <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
# Lower and Higher thresholds for deltaS
dsL = 0.3; dsH = 0.8
dsmgL = filter(dsmg, deltaSmg <= dsL) %>% select(-deltaSmg);
dsmgH = filter(dsmg, deltaSmg >= dsH) %>% select(-deltaSmg)
dsusL = filter(dsus, deltaSus <= dsL) %>% select(-deltaSus);
dsusH = filter(dsus, deltaSus >= dsH) %>% select(-deltaSus)
mgL_usH = inner_join(dsmgL, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>% # common rows between the two dataframes
rename(mgL_usH1 = color1, mgL_usH2 = color2)
mgH_usH = inner_join(dsmgH, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usH1 = color1, mgH_usH2 = color2)
mgL_usL = inner_join(dsmgL, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgL_usL1 = color1, mgL_usL2 = color2)
mgH_usL = inner_join(dsmgH, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usL1 = color1, mgH_usL2 = color2)
final <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
)
return(final)
getPairs <- function(dsL, dsH){
dsmgL = filter(dsmg, deltaSmg <= dsL) %>% select(-deltaSmg);
dsmgH = filter(dsmg, deltaSmg >= dsH) %>% select(-deltaSmg)
dsusL = filter(dsus, deltaSus <= dsL) %>% select(-deltaSus);
dsusH = filter(dsus, deltaSus >= dsH) %>% select(-deltaSus)
mgL_usH = inner_join(dsmgL, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>% # common rows between the two dataframes
rename(mgL_usH1 = color1, mgL_usH2 = color2)
mgH_usH = inner_join(dsmgH, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usH1 = color1, mgH_usH2 = color2)
mgL_usL = inner_join(dsmgL, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgL_usL1 = color1, mgL_usL2 = color2)
mgH_usL = inner_join(dsmgH, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usL1 = color1, mgH_usL2 = color2)
final <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
return(final)
}
final <- getPairs(dsL, dsH)
final <- getPairs(0.3, 0.7)
final <- getPairs(0.3, 0.8)
final <- getPairs(0.2, 0.8)
final <- getPairs(0.2, 0.7)
final <- getPairs(0.15, 0.7)
final <- getPairs(0.15, 0.75)
final <- getPairs(0.15, 0.71)
final <- getPairs(0.1, 0.7)
final <- getPairs(0.1, 0.7)
final %>% distinct(concept1, concept2)
final <- getPairs(0.1, 0.71)
final %>% distinct(concept1, concept2)
View(mgH_usH)
View(final)
final <- getPairs(0.1, 0.7)
final <- getPairs(0.1, 0.71)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
)
final <- getPairs(0.1, 0.7)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
)
max(dsmg$deltaSmg)
# Chunk 3: functions
### NOTE ###
# In the paper, the proposed fit as in the paper is: sd = 1.4*xbar*(1 - xbar)
# where xbar is the mean association across all people for this color and concept
###### Fit for function for the sd. Model s = a.xbar.(1-xbar)
# function to get the value of the coeff a
getFitSd <- function(data){
d1 <- data[1,];
a_start = d1$sd_sample / (d1$xbar * (1 - d1$xbar))
fit <- nls( sd_sample ~ a * xbar * (1-xbar), data = data, start = list(a = a_start))
return(fit)
}
## using the sd = a * xbar ^ b model
getFitSd2 <- function(data){
fit <- nls(sd_sample ~ a * xbar^b, data = data, start = list(a = 1, b = 1))
return(fit)
}
# function to get the values for xbars, sd_samples, and sd_fits for each pair of concepts and colors
# the resulting dataframe is a representation of the bigram in the paper
getXvalues <- function(data, concept_pairs, color_pairs, sd_fit_coef){
res <- data.frame()
# Loop through all concept pairs and color pairs to populate the res (for result) dataframe
for (i in 1:nrow(concept_pairs)) {
for (j in 1:nrow(color_pairs)) {
concept1 <- concept_pairs[i, 1]; concept2 <- concept_pairs[i, 2]
color1 <- color_pairs[j, 1]; color2 <- color_pairs[j, 2]
# Combine into a new row
new_row <- data.frame(
concept1 = concept1, concept2 = concept2,
color1 = color1, color2 = color2,
xbar1 = data$xbar[data$concept == concept1 & data$color == color1],
xbar2 = data$xbar[data$concept == concept1 & data$color == color2],
xbar3 = data$xbar[data$concept == concept2 & data$color == color1],
xbar4 = data$xbar[data$concept == concept2 & data$color == color2],
sd_sample1 = data$sd_sample[data$concept == concept1 & data$color == color1],
sd_sample2 = data$sd_sample[data$concept == concept1 & data$color == color2],
sd_sample3 = data$sd_sample[data$concept == concept2 & data$color == color1],
sd_sample4 = data$sd_sample[data$concept == concept2 & data$color == color2]
)
new_row <- mutate(new_row,
sd_fit1 = sd_fit_coef * xbar1 * (1 - xbar1),
sd_fit2 = sd_fit_coef * xbar2 * (1 - xbar2),
sd_fit3 = sd_fit_coef * xbar3 * (1 - xbar3),
sd_fit4 = sd_fit_coef * xbar4 * (1 - xbar4))
# Add the new row to the result dataframe
res <- rbind(res, new_row)
print(nrow(res))
}
}
return(res)
}
# write_csv(xUs, "output/xUs_not_optimized.csv")
## This is an by far more optimized version of the above function
getXvalues_opt <- function(data, concept_pairs, color_pairs, sd_fit_coef){
df1 <- merge(concept_pairs, color_pairs)
# lookup_df = data # %>% select(concept, color, xbar)
extended_DF <- df1 %>%
left_join(data, by = c("concept1" = "concept", "color1" = "color")) %>%
rename(xbar1 = xbar, sd_sample1 = sd_sample) %>%
left_join(data, by = c("concept1" = "concept", "color2" = "color")) %>%
rename(xbar2 = xbar, sd_sample2 = sd_sample) %>%
left_join(data, by = c("concept2" = "concept", "color1" = "color")) %>%
rename(xbar3 = xbar, sd_sample3 = sd_sample) %>%
left_join(data, by = c("concept2" = "concept", "color2" = "color")) %>%
rename(xbar4 = xbar, sd_sample4 = sd_sample)
x_opt <- mutate(extended_DF,
sd_fit1 = sd_fit_coef * xbar1 * (1 - xbar1),
sd_fit2 = sd_fit_coef * xbar2 * (1 - xbar2),
sd_fit3 = sd_fit_coef * xbar3 * (1 - xbar3),
sd_fit4 = sd_fit_coef * xbar4 * (1 - xbar4)) %>% mutate(deltaX = (xbar1 + xbar4) - (xbar2 + xbar3))
return(x_opt)
}
# function to get values of deltaS (either using sd_sample or fitted sd)
getDeltaS <- function(data){
data <- mutate(data,
ProbDelta_sample = pnorm( deltaX / sqrt(sd_sample1^2 + sd_sample2^2 + sd_sample3^2 + sd_sample4^2)),
ProbDelta_fit = pnorm( deltaX / sqrt(sd_fit1^2 + sd_fit2^2 + sd_fit3^2 + sd_fit4^2)))
data <- mutate(data,
deltaS_sample = abs(2 * ProbDelta_sample - 1),
deltaS_fit = abs(2 * ProbDelta_fit - 1))
return(data)
}
# Chunk 4: US data
# Aggregated data (x = average rating for each color of each concept)
dfus_agg <- dfus %>% group_by(concept, color) %>% summarise(xbar = mean(rating), sd_sample = sd(rating), .groups = 'drop')
knitr::opts_chunk$set(echo = TRUE)
source(file = './utils/exp1-utils.R')  # loads all necessary packages
# raw data exported from exp1-data-prep.R
dfus = read_csv("data/exp1/csv/clean/p3-us.csv")
dfmg = read_csv("data/exp1/csv/clean/p3-mg.csv") # extra column 'conceptFr' for the concept name in French
# Unique pairs of concepts and colors without repetition
concept_pairs <- as.data.frame(t(combn(unique(dfus$concept), 2))) %>% rename(concept1 = V1, concept2 = V2)
color_pairs <- as.data.frame(t(combn(unique(dfmg$color), 2))) %>% rename(color1 = V1, color2 = V2)
### NOTE ###
# In the paper, the proposed fit as in the paper is: sd = 1.4*xbar*(1 - xbar)
# where xbar is the mean association across all people for this color and concept
###### Fit for function for the sd. Model s = a.xbar.(1-xbar)
# function to get the value of the coeff a
getFitSd <- function(data){
d1 <- data[1,];
a_start = d1$sd_sample / (d1$xbar * (1 - d1$xbar))
fit <- nls( sd_sample ~ a * xbar * (1-xbar), data = data, start = list(a = a_start))
return(fit)
}
## using the sd = a * xbar ^ b model
getFitSd2 <- function(data){
fit <- nls(sd_sample ~ a * xbar^b, data = data, start = list(a = 1, b = 1))
return(fit)
}
# function to get the values for xbars, sd_samples, and sd_fits for each pair of concepts and colors
# the resulting dataframe is a representation of the bigram in the paper
getXvalues <- function(data, concept_pairs, color_pairs, sd_fit_coef){
res <- data.frame()
# Loop through all concept pairs and color pairs to populate the res (for result) dataframe
for (i in 1:nrow(concept_pairs)) {
for (j in 1:nrow(color_pairs)) {
concept1 <- concept_pairs[i, 1]; concept2 <- concept_pairs[i, 2]
color1 <- color_pairs[j, 1]; color2 <- color_pairs[j, 2]
# Combine into a new row
new_row <- data.frame(
concept1 = concept1, concept2 = concept2,
color1 = color1, color2 = color2,
xbar1 = data$xbar[data$concept == concept1 & data$color == color1],
xbar2 = data$xbar[data$concept == concept1 & data$color == color2],
xbar3 = data$xbar[data$concept == concept2 & data$color == color1],
xbar4 = data$xbar[data$concept == concept2 & data$color == color2],
sd_sample1 = data$sd_sample[data$concept == concept1 & data$color == color1],
sd_sample2 = data$sd_sample[data$concept == concept1 & data$color == color2],
sd_sample3 = data$sd_sample[data$concept == concept2 & data$color == color1],
sd_sample4 = data$sd_sample[data$concept == concept2 & data$color == color2]
)
new_row <- mutate(new_row,
sd_fit1 = sd_fit_coef * xbar1 * (1 - xbar1),
sd_fit2 = sd_fit_coef * xbar2 * (1 - xbar2),
sd_fit3 = sd_fit_coef * xbar3 * (1 - xbar3),
sd_fit4 = sd_fit_coef * xbar4 * (1 - xbar4))
# Add the new row to the result dataframe
res <- rbind(res, new_row)
print(nrow(res))
}
}
return(res)
}
# write_csv(xUs, "output/xUs_not_optimized.csv")
## This is an by far more optimized version of the above function
getXvalues_opt <- function(data, concept_pairs, color_pairs, sd_fit_coef){
df1 <- merge(concept_pairs, color_pairs)
# lookup_df = data # %>% select(concept, color, xbar)
extended_DF <- df1 %>%
left_join(data, by = c("concept1" = "concept", "color1" = "color")) %>%
rename(xbar1 = xbar, sd_sample1 = sd_sample) %>%
left_join(data, by = c("concept1" = "concept", "color2" = "color")) %>%
rename(xbar2 = xbar, sd_sample2 = sd_sample) %>%
left_join(data, by = c("concept2" = "concept", "color1" = "color")) %>%
rename(xbar3 = xbar, sd_sample3 = sd_sample) %>%
left_join(data, by = c("concept2" = "concept", "color2" = "color")) %>%
rename(xbar4 = xbar, sd_sample4 = sd_sample)
x_opt <- mutate(extended_DF,
sd_fit1 = sd_fit_coef * xbar1 * (1 - xbar1),
sd_fit2 = sd_fit_coef * xbar2 * (1 - xbar2),
sd_fit3 = sd_fit_coef * xbar3 * (1 - xbar3),
sd_fit4 = sd_fit_coef * xbar4 * (1 - xbar4)) %>% mutate(deltaX = (xbar1 + xbar4) - (xbar2 + xbar3))
return(x_opt)
}
# function to get values of deltaS (either using sd_sample or fitted sd)
getDeltaS <- function(data){
data <- mutate(data,
ProbDelta_sample = pnorm( deltaX / sqrt(sd_sample1^2 + sd_sample2^2 + sd_sample3^2 + sd_sample4^2)),
ProbDelta_fit = pnorm( deltaX / sqrt(sd_fit1^2 + sd_fit2^2 + sd_fit3^2 + sd_fit4^2)))
data <- mutate(data,
deltaS_sample = abs(2 * ProbDelta_sample - 1),
deltaS_fit = abs(2 * ProbDelta_fit - 1))
return(data)
}
# Aggregated data (x = average rating for each color of each concept)
dfus_agg <- dfus %>% group_by(concept, color) %>% summarise(xbar = mean(rating), sd_sample = sd(rating), .groups = 'drop')
a_us <- coef(getFitSd(dfus_agg)) # a = 1.384426
# Plotting the data points, and fitted curve
plot(dfus_agg$xbar, dfus_agg$sd_sample, main = "Fit for model s = a * xbar * (1 - xbar)",
xlab = "Mean (xbar)", ylab = "Standard Deviation (s)", pch = 16)
curve(coef(getFitSd(dfus_agg)) * x * (1 - x), add = TRUE, col = "orange", lwd = 2)
a_us2 <- coef(getFitSd2(dfus_agg))
plot(dfus_agg$xbar, dfus_agg$sd_sample, main = "Fit for model s = a * xbar^b",
xlab = "Mean (xbar)", ylab = "Standard Deviation (s)", pch = 16)
curve(coef(getFitSd2(dfus_agg))[1] * x^coef(getFitSd2(dfus_agg))[2], add = TRUE, col = "red", lwd = 2)
# The first model w/ a_us fits the data better, so we will use a_us from here
# xUs <- getXvalues(dfus_agg, concept_pairs, color_pairs, a_us) %>% mutate(deltaX = (xbar1 + xbar4) - (xbar2 + xbar3))
xUs2 <- getXvalues_opt(dfus_agg, concept_pairs, color_pairs, a_us) %>% mutate(deltaX = (xbar1 + xbar4) - (xbar2 + xbar3))
### Verifying if the outputs of getXvalues and getXvalues_opt are the same
# xus <- xUs[order(names(xUs))]; xus <- xus[order(row.names(xus)), ]
# xus2 <- xUs2[order(names(xUs2))]; xus2 <- xus2[order(row.names(xus2)),]
# anti_join(xus, xus2) # if nrow here == 0 then all rows in xus can be found in xus2, i.e. the two df are identical
# nrow(merge(xus, xus2))
deltaS_us <- getDeltaS(xUs) %>% select(concept1, concept2, color1, color2, deltaS_sample, deltaS_fit)
# mean(deltaS_us$deltaS_sample - deltaS_us$deltaS_fit) ~= -0.007, i.e. the fitted S is correct
dfmg_agg <- dfmg %>% group_by(concept, color) %>% summarise(xbar = mean(rating), sd_sample = sd(rating), .groups = 'drop')
a_mg <- coef(getFitSd(dfmg_agg)) # a = 1.536
# Plotting the data points, and fitted curve
plot(dfmg_agg$xbar, dfmg_agg$sd_sample, main = "Fit for the Function s = a * xbar * (1 - xbar)",
xlab = "Mean (xbar)", ylab = "Standard Deviation (s)", pch = 16)
curve(coef(getFitSd(dfmg_agg)) * x * (1 - x), add = TRUE, col = "orange", lwd = 2)
a_mg2 <- coef(getFitSd2(dfmg_agg))
plot(dfmg_agg$xbar, dfmg_agg$sd_sample, main = "Fit for model s = a * xbar^b",
xlab = "Mean (xbar)", ylab = "Standard Deviation (s)", pch = 16)
curve(coef(getFitSd2(dfmg_agg))[1] * x^coef(getFitSd2(dfmg_agg))[2], add = TRUE, col = "red", lwd = 2)
# The first model w/ a_mg fits the data better, so we will use a_mg from here
# xMg <- getXvalues(dfmg_agg, concept_pairs, color_pairs, a_mg) %>% mutate(deltaX = (xbar1 + xbar4) - (xbar2 + xbar3))
xMg2 <- getXvalues_opt(dfmg_agg, concept_pairs, color_pairs, a_mg) %>% mutate(deltaX = (xbar1 + xbar4) - (xbar2 + xbar3))
### Verifying if the outputs of getXvalues and getXvalues_opt are the same
# xmg <- xMg[order(names(xMg))]; xmg <- xmg[order(row.names(xmg)), ]
# xmg2 <- xMg2[order(names(xMg2))]; xmg2 <- xmg2[order(row.names(xmg2)),]
# anti_join(xmg, xmg2) # if nrow here == 0 then all rows in xmg can be found in xmg2, i.e. the two df are identical
# nrow(merge(xmg, xmg2))
deltaS_mg <- getDeltaS(xMg2) %>% select(concept1, concept2, color1, color2, deltaS_sample, deltaS_fit)
# Finding four pairs of colors for each pair of concepts
## working with deltaS_mg and deltaS_us
dsmg <- deltaS_mg %>% select(-deltaS_sample) %>% rename(deltaSmg = deltaS_fit)
dsus <- deltaS_us %>% select(-deltaS_sample) %>% rename(deltaSus = deltaS_fit)
# Lower and Higher thresholds for deltaS
dsL = 0.3; dsH = 0.75
getPairs <- function(dsL, dsH){
dsmgL = filter(dsmg, deltaSmg <= dsL) %>% select(-deltaSmg);
dsmgH = filter(dsmg, deltaSmg >= dsH) %>% select(-deltaSmg)
dsusL = filter(dsus, deltaSus <= dsL) %>% select(-deltaSus);
dsusH = filter(dsus, deltaSus >= dsH) %>% select(-deltaSus)
mgL_usH = inner_join(dsmgL, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>% # common rows between the two dataframes
rename(mgL_usH1 = color1, mgL_usH2 = color2)
mgH_usH = inner_join(dsmgH, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usH1 = color1, mgH_usH2 = color2)
mgL_usL = inner_join(dsmgL, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgL_usL1 = color1, mgL_usL2 = color2)
mgH_usL = inner_join(dsmgH, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usL1 = color1, mgH_usL2 = color2)
final <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
return(final)
}
final <- getPairs(0.1, 0.7)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
); a
# Lower and Higher thresholds for deltaS
dsL = 0.3; dsH = 0.7
getPairs <- function(dsL, dsH){
dsmgL = filter(dsmg, deltaSmg <= dsL) %>% select(-deltaSmg);
dsmgH = filter(dsmg, deltaSmg >= dsH) %>% select(-deltaSmg)
dsusL = filter(dsus, deltaSus <= dsL) %>% select(-deltaSus);
dsusH = filter(dsus, deltaSus >= dsH) %>% select(-deltaSus)
mgL_usH = inner_join(dsmgL, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>% # common rows between the two dataframes
rename(mgL_usH1 = color1, mgL_usH2 = color2)
mgH_usH = inner_join(dsmgH, dsusH, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usH1 = color1, mgH_usH2 = color2)
mgL_usL = inner_join(dsmgL, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgL_usL1 = color1, mgL_usL2 = color2)
mgH_usL = inner_join(dsmgH, dsusL, by = c('concept1', 'concept2', 'color1', 'color2')) %>%
rename(mgH_usL1 = color1, mgH_usL2 = color2)
final <- mgL_usH %>%
full_join(mgH_usH, by = c('concept1', 'concept2')) %>%
full_join(mgL_usL, by = c('concept1', 'concept2')) %>%
full_join(mgH_usL, by = c('concept1', 'concept2')) %>% drop_na()
return(final)
}
final <- getPairs(0.1, 0.7)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
); a
final <- getPairs(0.1, 0.7)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
); a
final <- getPairs(0.3, 0.7)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
); a
final <- getPairs(0.15, 0.7)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
); a
final <- getPairs(0.1, 0.7)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
); a
final <- getPairs(0.3, 0.7)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
); a
final <- getPairs(0.2, 0.7)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
); a
final <- getPairs(0.1, 0.7)
final %>% distinct(concept1, concept2)
a <- final %>% group_by(concept1, concept2) %>% summarize(
freq = n()
); a
View(final)
